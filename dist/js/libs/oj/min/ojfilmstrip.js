/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojcomponentcore","promise"],function(a,g){a.zf=function(){this.Init()};a.b.ta(a.zf,a.pj,"oj.FilmStripPagingModel");a.zf.prototype.Init=function(){a.zf.u.Init.call(this);this.ge=-1;this.Gf=0;this.Fb=-1};a.b.g("FilmStripPagingModel.prototype.Init",{Init:a.zf.prototype.Init});a.zf.prototype.wJa=function(a){this.Gf=a};a.zf.prototype.getPage=function(){return this.ge};a.b.g("FilmStripPagingModel.prototype.getPage",{getPage:a.zf.prototype.getPage});a.zf.prototype.setPage=
function(a,b){a=parseInt(a,10);try{var d=this.getPageCount(),e=this.ge,f=this.Fb,g=f;b&&b.pageSize&&(g=b.pageSize);if(0===this.Gf&&-1===g)return Promise.resolve();var k=Math.ceil(this.Gf/g);if(0>a||a>k-1)throw Error("JET FilmStrip: Invalid 'page' set: "+a);var l=!1;if(a!=e||g!=f){if(!1===this.handleEvent("beforePage",{page:a,previousPage:e}))return Promise.reject();l=!0}this.ge=a;this.Fb=g;var m=this.getPageCount(),s=this;return new Promise(function(b){d!=m&&s.handleEvent("pageCount",{pageCount:m,
previousPageCount:d});l&&s.handleEvent("page",{page:a,previousPage:e});b(null)})}catch(t){return Promise.reject(t)}};a.b.g("FilmStripPagingModel.prototype.setPage",{setPage:a.zf.prototype.setPage});a.zf.prototype.getStartItemIndex=function(){return-1===this.ge&&-1===this.Fb?-1:this.ge*this.Fb};a.b.g("FilmStripPagingModel.prototype.getStartItemIndex",{getStartItemIndex:a.zf.prototype.getStartItemIndex});a.zf.prototype.getEndItemIndex=function(){return Math.min(this.getStartItemIndex()+this.Fb,this.Gf)-
1};a.b.g("FilmStripPagingModel.prototype.getEndItemIndex",{getEndItemIndex:a.zf.prototype.getEndItemIndex});a.zf.prototype.getPageCount=function(){return Math.ceil(this.Gf/this.Fb)};a.b.g("FilmStripPagingModel.prototype.getPageCount",{getPageCount:a.zf.prototype.getPageCount});a.zf.prototype.totalSize=function(){return this.Gf};a.b.g("FilmStripPagingModel.prototype.totalSize",{totalSize:a.zf.prototype.totalSize});a.zf.prototype.totalSizeConfidence=function(){return"actual"};a.b.g("FilmStripPagingModel.prototype.totalSizeConfidence",
{totalSizeConfidence:a.zf.prototype.totalSizeConfidence});(function(){function c(a){var b=g("\x3cdiv\x3e\x3c/div\x3e");b.text(a);return b[0].innerHTML}function b(a){a.css("-webkit-transform",t).css("-ms-transform",t).css("transform",t)}function d(a,b){a.css("-webkit-transform",b).css("-ms-transform",b).css("transform",b)}a.Na("oj.ojFilmStrip",g.oj.baseComponent,{defaultElement:"\x3cdiv\x3e",widgetEventPrefix:"oj",options:{maxItemsPerPage:0,orientation:"horizontal",currentItem:0,arrowPlacement:"adjacent",
arrowVisibility:"auto"},_ComponentCreate:function(){this._super();var b=this.element;b.addClass("oj-filmstrip oj-component").attr("tabindex",0).attr("role","region");b.uniqueId();b=this.options;b.disabled&&a.r.warn(ba);if(b.orientation!==y&&b.orientation!==ea)throw Error(n+b.orientation);if(b.arrowPlacement!==e&&b.arrowPlacement!==U)throw Error(p+b.arrowPlacement);if(b.arrowVisibility!==ga&&b.arrowVisibility!==w&&b.arrowVisibility!==x&&b.arrowVisibility!==h)throw Error(q+b.arrowVisibility);this.dG=
this.eventNamespace+"Touch";this.mN=this.eventNamespace+"Mouse";this.Gga=this.eventNamespace+"Key";this.jZ=this.eventNamespace+"NavArrowHoverable";this.ab(!0)},refresh:function(){this._super();this.ab(!1)},getItemsPerPage:function(){return this.Ev},getPagingModel:function(){return this.Ef},Rp:function(){this._super();this.Fe&&this.ab(this.Fe[0])},Mr:function(){this._super();this.Fe&&this.ab(this.Fe[0])},ab:function(b){b&&!this.Ef&&(this.Ef=new a.zf);if(this.fC()){this.Fe=null;this.Th="rtl"===this.jd();
this.Zr=a.A.Ke();var c=this.element,d=this;b?(this.Ev=0,this.RT=function(a){d.QT(a)},this.gs=0,this.sD=-1,this.Eo=function(){d.uv()},this.Jj=function(){d.Gg()},this.Zr&&(this.J8=function(a){d.bU(a)},this.I8=function(a){d.aU(a)},this.$T=function(a){d.ZT(a)},this.doa()),this.x8=function(a){d.Xva(a)},this.y8=function(a){d.Yva(a)},this.A8=function(a){d.$va(a)},this.Yna(),this.w8=function(a){d.qv(a)},this.Wna()):this.v5();for(var e=c.children(),f=0;f<e.length;f++)a.Components.wi(e[f]);f=this.Ef;if(b)f.on("page",
this.RT);f.wJa(e.length);this.$Da();if(0<e.length){this.r3();for(f=0;f<e.length;f++)a.Components.Ug(e[f]);a.A.Ok(c[0],this.Jj)}}else c=!1,this.Fe&&(c=this.Fe[0]),this.Fe=[b||c]},_destroy:function(){this.Zr&&(this.UAa(),this.$T=this.I8=this.J8=null);this.KAa();this.A8=this.y8=this.x8=null;this.IAa();this.w8=null;this.v5();this.Ef.off("page",this.RT);this.Eo=this.Jj=this.Ef=this.RT=null;var a=this.element;a.removeClass("oj-filmstrip oj-component "+J).removeAttr("tabindex role");a.removeUniqueId();this._super()},
v5:function(){a.A.nm(this.element[0],this.Jj);this.sD=-1;this.TD&&(clearTimeout(this.TD),this.TD=null);for(var b=this.aJ(),c=0;c<b.length;c++)a.Components.wi(b[c]);this.s4();this.OS().unwrap();this.CDa();for(c=0;c<b.length;c++)a.Components.Ug(b[c])},_setOption:function(b,c,d){var f=this.options,g=!1,k=-1,l=this.Ef,m=l.getPage();switch(b){case "disabled":a.r.warn(ba);break;case "orientation":if(c!==y&&c!==ea)throw Error(n+c);g=f.orientation!=c;break;case "maxItemsPerPage":g=f.maxItemsPerPage!=c;break;
case "arrowPlacement":if(c!==e&&c!==U)throw Error(p+c);g=f.arrowPlacement!=c;break;case "arrowVisibility":if(c!==ga&&c!==w&&c!==x&&c!==h)throw Error(q+c);g=f.arrowVisibility!=c;break;case z:if(f.currentItem!=c&&(k=this.kS(c),0>k||k>=l.getPageCount()))throw Error(r+c);}this._super(b,c,d);switch(b){case z:-1<k&&k!=m&&l.setPage(k)}g&&this.ab(!1)},Gg:function(){if(!this.F3)this.F3=!0,this.r3(!0),this.F3=!1;else if(!this.TD){var a=this;this.TD=setTimeout(function(){a.TD=null;a.Gg()},0)}},vd:function(){return this.options.orientation!==
ea},MC:function(){return this.vd()?this.Th?"right":"left":"top"},hv:function(){return this.vd()?"width":"height"},fC:function(){var a=document.createElement("div"),b=a.style;b.position="absolute";b.width="10px";b.height="10px";b=this.element[0];b.appendChild(a);var c=!1;try{c=0<a.offsetWidth&&0<a.offsetHeight}catch(d){}b.removeChild(a);return c},$Da:function(){var a=this.element,b=this.vd(),c=a.children();c.addClass(F).wrap("\x3cdiv class\x3d'"+A+" "+E+"'\x3e\x3c/div\x3e");var d=this.MC();this.gn=
d=a.children().wrapAll("\x3cdiv class\x3d'"+A+" "+L+"' style\x3d'"+d+": 0px;'\x3e\x3c/div\x3e").parent();var f=this.options;f.arrowVisibility!==w&&f.arrowPlacement===e&&(this.rR=d.wrap("\x3cdiv class\x3d'"+A+" oj-filmstrip-content-container'\x3e\x3c/div\x3e").parent());a.addClass(A);b||a.addClass(fa);f.arrowVisibility!==w&&0<c.length&&(this.Jk=this.Jqa(),this.Pj=this.vqa(),this.WU()&&this.CCa())},CDa:function(){var a=this.element,b=this.aJ();this.eDa();this.Jk&&(this.Nu(this.Jk),this.Jk=null);this.Pj&&
(this.Nu(this.Pj),this.Pj=null);var c=a.children(O+C);c&&c.remove();b.removeClass(F).unwrap().unwrap();this.gn=null;this.rR&&(b.unwrap(),this.rR=null);a.removeClass(A+" "+fa)},CCa:function(){this.element.on("mouseenter"+this.jZ,function(a){g(a.currentTarget).hasClass("oj-disabled")||g(a.currentTarget).addClass(J)}).on("mouseleave"+this.jZ,function(a){g(a.currentTarget).removeClass(J)})},eDa:function(){this.element.off(this.jZ)},WU:function(){var a=this.options,b=a.arrowVisibility;return b===x||b===
h&&a.arrowPlacement===U},Ewa:function(){return 0<this.Ef.getPage()},Dwa:function(){var a=this.Ef;return a.getPage()<a.getPageCount()-1},Gza:function(){if(this.Ewa()){var a=this.Ef;a.setPage(a.getPage()-1)}},Zya:function(){if(this.Dwa()){var a=this.Ef;a.setPage(a.getPage()+1)}},D5:function(a,b){this.options.arrowPlacement===e?b.css("visibility",a?"":w):b.parent().css("display",a?"":D)},RDa:function(){if(this.options.arrowVisibility!==w){var a=this.Ef,b=a.getPage(),a=a.getPageCount();this.D5(0!==b,
this.Jk);this.D5(b!==a-1,this.Pj)}},Jqa:function(){var a=this.element,b=this.vd()?ha:ca,d=this.V4(b);this.options.arrowPlacement===U?a.append(d):a.prepend(d);var a=c(this.F("labelAccArrowPreviousPage")),e=c(this.F("tipArrowPreviousPage")),b=this.U4(d,b,a,e),f=this;b.on("click",function(){f.Gza()});return b},vqa:function(){var a=this.element,b=this.vd()?B:G,d=this.V4(b);a.append(d);var a=c(this.F("labelAccArrowNextPage")),e=c(this.F("tipArrowNextPage")),b=this.U4(d,b,a,e),f=this;b.on("click",function(){f.Zya()});
return b},V4:function(a){var b=g(document.createElement("div"));b.addClass(C+" "+a);this.options.arrowPlacement===U&&(b.addClass("oj-filmstrip-arrow-container-overlay"),this.WU()&&b.addClass(K));return b},U4:function(a,b,c,d){var f="\x3cdiv class\x3d'"+H+" oj-default oj-enabled "+b+"' role\x3d'button' tabindex\x3d'-1'";a.append(f+("\x3e\x3cspan class\x3d'oj-filmstrip-arrow-icon "+b+" oj-component-icon'\x3e\x3c/span\x3e\x3c/div\x3e"));b=this.element.attr("id");a=a.children(O+H).eq(0);a.uniqueId();
f=a.attr("id");c&&a.attr("aria-label",c);d&&a.attr("title",d);a.attr("aria-labelledby",f+" "+b);this.Qe(a);this.rk(a);this.options.arrowPlacement===e&&this.WU()&&a.addClass(K);return a},OS:function(){return this.gn.find(O+E)},aJ:function(){return this.gn.find(O+F)},ts:function(){return this.gn.children(O+I)},s4:function(){var a=this.gn;this.ts().css(u,t).css(X,t);this.OS().css(u,t).css(X,t);a.css(this.hv(),t)},r3:function(b){this.s4();var c=this.options,d=this.vd(),h=c.maxItemsPerPage,l=1>h,m=this.element,
p=this.OS();if(0>this.sD){var q=this.g7(c.currentItem),q=g(p[q]),n=q.children(O+F);n.css(k,t);a.Components.wr(n[0]);this.sD=d?q.width():q.height()}q=d?m.width():m.height();c.arrowVisibility!==w&&c.arrowPlacement===e&&(m=m.children(O+C).eq(0),d=d?m.width():m.height(),q-=2*d);this.gs=q;l||(d=Math.max(Math.floor(q/this.sD),1),d<h&&(h=d));h=l?Math.max(Math.floor(q/this.sD),1):h;l=q/h;p.css(u,l+Z).css(X,l+Z);l=Math.ceil(p.length/h);n=this.ts();d=!1;m=this.Ef;if(m.getPageCount()!=l||this.Ev!=h||!n||1>n.length){d=
!0;if(b)for(var r=0;r<p.length;r++)a.Components.wi(p[r]);n&&0<n.length&&p.unwrap();for(r=0;r<p.length;r+=h)p.slice(r,r+h).wrapAll("\x3cdiv class\x3d'"+A+" "+I+"' style\x3d'"+k+": "+D+";' "+f+"\x3d'true'\x3e\x3c/div\x3e");if(b)for(r=0;r<p.length;r++)a.Components.Ug(p[r])}n=this.ts();n.css(u,q+Z).css(X,q+Z);b=this.rR;this.gn.css(this.hv(),q);b&&b.css(this.hv(),q);b=0;if(c.currentItem||0===c.currentItem)b=this.kS(c.currentItem,h);m.getPageCount()!=l||this.Ev!=h||m.getPage()!=b?m.setPage(b,{pageSize:h}):
d&&(c=m.getPage(),this.QT({previousPage:c,page:c}))},QT:function(a){var b=a.page,c=a.previousPage;a=this.gn;var d=this.ts(),e=this.Ef.Fb,f=0>c||c==b||this.Ev!=e;this.Ev=e;e=null;f||(e=g(d[c]));var h=this.MC(),k=g(d[b]),l=k.is(v);l&&this.JW(k);var m=this.$x;-1<c&&!f&&(m=!0,a.css(this.hv(),2*this.gs),b<c&&l&&a.css(h,-this.gs+Z),b>c?(e.addClass(Q),k.addClass(M)):(e.addClass(R),k.addClass(N)));if(m){var p=this,q=this.$x;q&&0>c&&d.filter(W).addClass(P);setTimeout(function(){p.g6(b,c,f,q)},25)}else this.g6(b,
c,f)},g6:function(a,c,e,f){var h=this.gn;e||(this.G3=!0,h.on("transitionend"+this.eventNamespace+" webkitTransitionEnd"+this.eventNamespace,this.Eo));e?this.uv():(e=this.ts(),f&&b(e),-1<c?(f=a>c,c=g(e[c]),a=g(e[a]),c.addClass(P),a.addClass(P),f?(c.removeClass(Q),a.removeClass(M),c.addClass(V),a.addClass(Y)):(c.removeClass(R),a.removeClass(N),c.addClass(S),a.addClass(T))):f&&(a=e.filter(W),d(a,"translate3d(0, 0, 0)")))},uv:function(){this.G3=!1;var c=this.gn,d=this.MC();c.off(this.eventNamespace).css(this.hv(),
this.gs).css(d,"0px");d=null;if(a.le.FL(c[0])||this.Pj&&a.le.FL(this.Pj[0])||this.Jk&&a.le.FL(this.Jk[0]))d=document.activeElement;for(var c=this.Ef.getPage(),e=this.ts(),f=0;f<e.length;f++)f!=c&&this.Q8(g(e[f]));e.removeClass(P+" "+V+" "+Y+" "+S+" "+T);b(e);this.RDa();d&&g(d).is(v)&&(d=this.element,(e=a.le.bfa(e[c]))?a.le.UE(e):a.le.UE(d[0]));this.kS(this.options.currentItem)!=c&&(c=this.T6(c),-1!==c&&this.option(z,c,{_context:{Ed:!0}}))},g7:function(b){var c=-1,d=this.aJ();if("number"===typeof b)0<=
b&&b<d.length&&(c=b);else if("string"===typeof b&&a.A.GM(b))for(var e=0;e<d.length;e++){var f=d[e].id;if(f&&0<f.length&&f===b){c=e;break}}return c},kS:function(a,b){var c=this.g7(a),d=-1;-1<c&&(void 0===b&&(b=this.Ev),d=Math.floor(c/b));return d},T6:function(a,b,c){var d=this.Ef;void 0===b&&(b=d.getPageCount());return 0<=a&&a<b&&(b=this.aJ(),void 0===c&&(c=this.Ev),a*=c,a<b.length)?(c=b[a].id)&&0<c.length?c:a:-1},Q8:function(b){a.Components.Xt(b[0]);b.css(k,D).attr(f,"true");b.find(O+F).css(k,D)},
JW:function(b){b.css(k,t).removeAttr(f);b.find(O+F).css(k,t);a.Components.wr(b[0])},Wna:function(){this.element.on("keydown"+this.Gga,this.w8)},IAa:function(){this.element.off(this.Gga)},Yna:function(){this.element.on("mousedown"+this.mN,this.x8).on("mousemove"+this.mN,this.y8).on("mouseup"+this.mN,this.A8)},KAa:function(){this.element.off(this.mN)},doa:function(){this.element.on("touchstart"+this.dG,this.J8).on("touchmove"+this.dG,this.I8).on("touchend"+this.dG,this.$T).on("touchcancel"+this.dG,
this.$T)},UAa:function(){this.element.off(this.dG)},qv:function(a){var b=this.Ef,c=b.getPage(),d=-1;switch(a.keyCode){case g.ui.keyCode.RIGHT:d=this.Th?c-1:c+1;break;case g.ui.keyCode.LEFT:d=this.Th?c+1:c-1;break;case g.ui.keyCode.DOWN:d=c+1;break;case g.ui.keyCode.UP:d=c-1;break;case g.ui.keyCode.HOME:d=0;break;case g.ui.keyCode.END:d=b.getPageCount()-1;break;default:return}-1<d&&d<b.getPageCount()&&b.setPage(d);a.preventDefault()},Xva:function(a){this.O5(a.originalEvent)},Yva:function(a){this.N5(a,
a.originalEvent)},$va:function(){this.M5()},bU:function(a){a=a.originalEvent.touches;1===a.length&&this.O5(a[0])},aU:function(a){this.N5(a,a.originalEvent.touches[0]);(this.zl||this.Xv)&&a.preventDefault()},ZT:function(){this.M5()},O5:function(a){if(1<this.Ef.getPageCount()&&!this.G3){this.zl=!0;this.$x=!1;var b=this.vd();this.cL=b?a.pageX:a.pageY;this.Yca=b?a.pageY:a.pageX}},Zwa:function(a){var b=this.vd();this.cL=b?a.pageX:a.pageY;this.Yca=b?a.pageY:a.pageX;a=this.MC();var b=this.gn,c=this.Ef,d=
this.ts(),e=1;0<c.getPage()&&(this.JW(g(d[c.getPage()-1])),b.css(a,-this.gs+Z),e++);c.getPage()<c.getPageCount()-1&&(this.JW(g(d[c.getPage()+1])),e++);1<e&&b.css(this.hv(),e*this.gs);this.uW=parseInt(b.css(a),10)},N5:function(a,b){if(this.zl){var c=this.vd(),e=(c?b.pageX:b.pageY)-this.cL;Math.abs((c?b.pageY:b.pageX)-this.Yca)>Math.abs(e)&&(this.Xv=this.zl=!1);if(this.$x){var f=c&&this.Th?0<e:0>e,h=this.Ef,k=h.getPage();if(f&&k<h.getPageCount()-1||!f&&0<k){var p=this.element[0],q=Math.min(m*(c?p.offsetWidth:
p.offsetHeight),s),n=this.MC(),r=this.gn,p=this.ts();Math.abs(e)>=q?(c=f?k+1:k-1,this.T6(c),k=f?k-1:k+1,-1<k&&k<h.getPageCount()&&this.Q8(g(p[k])),f&&-1<k&&(p=parseInt(r.css(n),10),r.css(n,p+this.gs+Z)),r.css(this.hv(),2*this.gs),this.zl=!1,h.setPage(c)):(h=c&&this.Th?-e:e,h=c?"translate3d("+h+"px, 0, 0)":"translate3d(0, "+h+"px, 0)",d(p.filter(W),h));this.Xv=!0}this.Xv&&(a.preventDefault(),a.stopPropagation())}else Math.abs(e)>l&&(this.Zwa(b),this.$x=!0)}},M5:function(){if(this.zl&&this.$x){var a=
this.Ef.getPage();this.QT({previousPage:a,page:a})}this.Xv=this.$x=this.zl=!1},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;a=a.subId;return"oj-filmstrip-start-arrow"===a?this.widget().find(O+H+O+ha)[0]:"oj-filmstrip-end-arrow"===a?this.widget().find(O+H+O+B)[0]:"oj-filmstrip-top-arrow"===a?this.widget().find(O+H+O+ca)[0]:"oj-filmstrip-bottom-arrow"===a?this.widget().find(O+H+O+G)[0]:null},getSubIdByNode:function(a){for(var b=this.getNodeBySubId({subId:"oj-filmstrip-start-arrow"}),
c=this.getNodeBySubId({subId:"oj-filmstrip-end-arrow"}),d=this.getNodeBySubId({subId:"oj-filmstrip-top-arrow"}),e=this.getNodeBySubId({subId:"oj-filmstrip-bottom-arrow"}),f=this.element[0];a&&a!=f;){if(a===b)return{subId:"oj-filmstrip-start-arrow"};if(a===c)return{subId:"oj-filmstrip-end-arrow"};if(a===d)return{subId:"oj-filmstrip-top-arrow"};if(a===e)return{subId:"oj-filmstrip-bottom-arrow"};a=a.parentElement}return null}});var e="adjacent",f="aria-hidden",h="auto",k="display",l=3,m=.33,s=100,t=
"",r="JET FilmStrip: Value of 'currentItem' option not found: ",n="JET FilmStrip: Unsupported value set as 'orientation' option: ",p="Unsupported value set as 'arrowPlacement' option: ",q="Unsupported value set as 'arrowVisibility' option: ",u="flex-basis",w="hidden",v=":hidden",y="horizontal",x="hover",z="currentItem",D="none",G="oj-bottom",B="oj-end",H="oj-filmstrip-arrow",C="oj-filmstrip-arrow-container",K="oj-filmstrip-arrow-transition",A="oj-filmstrip-container",J="oj-filmstrip-hover",F="oj-filmstrip-item",
E="oj-filmstrip-item-container",I="oj-filmstrip-page",L="oj-filmstrip-pages-container",P="oj-filmstrip-transition",M="oj-filmstrip-transition-next-newpage-from",Q="oj-filmstrip-transition-next-oldpage-from",N="oj-filmstrip-transition-prev-newpage-from",R="oj-filmstrip-transition-prev-oldpage-from",Y="oj-filmstrip-transition-next-newpage-to",V="oj-filmstrip-transition-next-oldpage-to",T="oj-filmstrip-transition-prev-newpage-to",S="oj-filmstrip-transition-prev-oldpage-to",fa="oj-filmstrip-vertical",
ha="oj-start",ca="oj-top",U="overlay",O=".",Z="px",ea="vertical",ga="visible",W=":visible",X="-webkit-flex-basis",ba="JET FilmStrip: 'disabled' option not supported"})();a.Components.Va("ojFilmStrip","baseComponent",{properties:{arrowPlacement:{type:"string"},arrowVisibility:{type:"string"},currentItem:{type:"string|number"},disabled:{type:"boolean"},maxItemsPerPage:{type:"number"},orientation:{type:"string"}},methods:{getItemsPerPage:{},getPagingModel:{},refresh:{}},extension:{_widgetName:"ojFilmStrip"}});
a.Components.register("oj-film-strip",a.Components.getMetadata("ojFilmStrip"))});