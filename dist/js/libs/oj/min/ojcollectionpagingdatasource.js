/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","knockout","ojs/ojdatasource-common","ojs/ojmodel","ojs/ojknockout-model"],function(b,f,a){b.pb=function(a){this.Ba=a;this.current=0;this.Init();this.Gf=[];this.EL(10)};o_("CollectionPagingDataSource",b.pb,b);b.b.ga(b.pb,b.Ri,"oj.CollectionPagingDataSource");b.pb.prototype.Init=function(){b.pb.q.Init.call(this)};b.b.g("CollectionPagingDataSource.prototype.Init",{Init:b.pb.prototype.Init});b.pb.prototype.pJ=function(){return this.Qw()?this.gm:this.totalSize()-this.current};
b.pb.prototype.Hq=function(){this.Gf=Array(this.pJ());var a=this;return this.Ba.Rr(this.current,this.current+this.Gf.length).then(function(b){for(var e=0;e<b.length;e++)a.Gf[e]=b[e];a.Fx();a.ij=a.$+a.Gf.length-1})};b.pb.prototype.Fx=function(){if(void 0!==this.Nj){this.Nj.removeAll();for(var a=0;a<this.Gf.length;a++)this.Nj.push(b.Ha.map(this.Gf[a]))}};b.pb.prototype.rm=function(){return this.Gf};b.b.g("CollectionPagingDataSource.prototype.getWindow",{rm:b.pb.prototype.rm});b.pb.prototype.Ey=function(){void 0===
this.Nj&&(this.Nj=a.observableArray(),this.Fx());return this.Nj};b.b.g("CollectionPagingDataSource.prototype.getWindowObservable",{Ey:b.pb.prototype.Ey});b.pb.prototype.getPage=function(){return this.Mc};b.b.g("CollectionPagingDataSource.prototype.getPage",{getPage:b.pb.prototype.getPage});b.pb.prototype.setPage=function(a,c){c=c||{};a=parseInt(a,10);try{b.pb.q.handleEvent.call(this,b.bc.D.BEFOREPAGE,{page:a,previousPage:this.Mc})}catch(e){return Promise.reject(null)}this.pageSize=null!=c.pageSize?
c.pageSize:this.pageSize;c.startIndex=a*this.pageSize;var f=this.Mc;this.Mc=a;this.$=c.startIndex;var h=this;return new Promise(function(a,d){h.Ce(c).then(function(){b.pb.q.handleEvent.call(h,b.bc.D.PAGE,{page:h.Mc,previousPage:f});a(null)},function(){h.Mc=f;h.$=h.Mc*h.pageSize;d(null)})})};b.b.g("CollectionPagingDataSource.prototype.setPage",{setPage:b.pb.prototype.setPage});b.pb.prototype.getStartItemIndex=function(){return this.$};b.b.g("CollectionPagingDataSource.prototype.getStartItemIndex",
{getStartItemIndex:b.pb.prototype.getStartItemIndex});b.pb.prototype.getEndItemIndex=function(){return this.ij};b.b.g("CollectionPagingDataSource.prototype.getEndItemIndex",{getEndItemIndex:b.pb.prototype.getEndItemIndex});b.pb.prototype.getPageCount=function(){var a=this.totalSize();return-1==a?-1:Math.ceil(a/this.pageSize)};b.b.g("CollectionPagingDataSource.prototype.getPageCount",{getPageCount:b.pb.prototype.getPageCount});b.pb.prototype.fetch=function(a){var b=a||{};if(void 0!==b.pageSize&&void 0!==
b.startIndex){if(!this.Qw())return this.GC(null),Promise.resolve();this.gm=b.startIndex+b.pageSize;var e=this;return this.Hq().then(function(){e.GC(null)})}return this.Ce(a)};b.b.g("CollectionPagingDataSource.prototype.fetch",{fetch:b.pb.prototype.fetch});b.pb.prototype.Ce=function(a){var b=a||{};void 0!==b.startIndex&&(this.current=b.startIndex);void 0!==b.pageSize&&(this.gm=this.pageSize=b.pageSize);var e=this;return new Promise(function(a){try{e.Ba.fetch({success:function(){e.Hq().then(function(){e.GC(b);
a({data:e.rm(),startIndex:e.current})})}})}catch(d){e.Hq().then(function(){e.GC(b);a({data:e.rm(),startIndex:e.current})})}})};b.pb.prototype.GC=function(a){a=a||{};a.silent||this.handleEvent("sync",{data:this.rm(),startIndex:this.current});a.success&&a.success()};b.pb.prototype.handleEvent=function(a,c){return b.pb.q.handleEvent.call(this,a,c)};b.pb.prototype.Qw=function(){return this.current+this.gm<this.totalSize()};b.pb.prototype.EL=function(a){this.gm=this.pageSize=a};b.pb.prototype.size=function(){var a=
this.rm();return a?a.length:0};b.b.g("CollectionPagingDataSource.prototype.size",{size:b.pb.prototype.size});b.pb.prototype.totalSize=function(){return this.Ba.length};b.b.g("CollectionPagingDataSource.prototype.totalSize",{totalSize:b.pb.prototype.totalSize});b.pb.prototype.totalSizeConfidence=function(){return"actual"};b.b.g("CollectionPagingDataSource.prototype.totalSizeConfidence",{totalSizeConfidence:b.pb.prototype.totalSizeConfidence});b.pb.prototype.getCapability=function(){return null};b.b.g("CollectionPagingDataSource.prototype.getCapability",
{getCapability:b.pb.prototype.getCapability})});