/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common","ojs/ojmodel"],function(b){b.Lc=function(f,a,d,c,e){b.l.ly(d);this.$b=f;this.qe=a;this.uE=d;this.Bg=c;this.g4=e};o_("CollectionHeaderSet",b.Lc,b);b.Lc.prototype.c5=function(f){b.l.KD(f);null!=f&&f.length===this.R()&&(this.rr=f)};b.Lc.prototype.getData=function(f,a){var d;b.l.assert(f<=this.qe&&f>=this.$b,"index out of bounds");b.l.assert(null==a||0==a,"level out of bounds");if(null!=this.Bg){if(null==this.rr)return null;d=this.rr[f-this.$b];
return d.get(this.Bg)}return this.uE[f]};b.b.g("CollectionHeaderSet.prototype.getData",{getData:b.Lc.prototype.getData});b.Lc.prototype.getMetadata=function(f,a){var d;b.l.assert(f<=this.qe&&f>=this.$b,"index out of bounds");b.l.assert(null==a||0==a,"level out of bounds");if(null!=this.Bg){if(null==this.rr)return null;d=this.rr[f-this.$b];return{key:b.ip.jt(d)}}d=this.getData(f,a);return this.g4.key===d?{key:d,sortDirection:this.g4.direction}:{key:d}};b.b.g("CollectionHeaderSet.prototype.getMetadata",
{getMetadata:b.Lc.prototype.getMetadata});b.Lc.prototype.vg=function(){return 0<this.R()?1:0};b.b.g("CollectionHeaderSet.prototype.getLevelCount",{vg:b.Lc.prototype.vg});b.Lc.prototype.Ub=function(f,a){b.l.assert(f<=this.qe&&f>=this.$b,"index out of bounds");b.l.assert(null==a||0==a,"level out of bounds");return{extent:1,more:{before:!1,after:!1}}};b.b.g("CollectionHeaderSet.prototype.getExtent",{Ub:b.Lc.prototype.Ub});b.Lc.prototype.ke=function(f,a){b.l.assert(f<=this.qe&&f>=this.$b,"index out of bounds");
b.l.assert(null==a||0==a,"level out of bounds");return 1};b.b.g("CollectionHeaderSet.prototype.getDepth",{ke:b.Lc.prototype.ke});b.Lc.prototype.R=function(){return Math.max(0,this.qe-this.$b)};b.b.g("CollectionHeaderSet.prototype.getCount",{R:b.Lc.prototype.R});b.Lc.prototype.ta=function(){return this.$b};b.b.g("CollectionHeaderSet.prototype.getStart",{ta:b.Lc.prototype.ta});b.Lc.prototype.H2=function(){return this.qe};b.b.g("CollectionHeaderSet.prototype.getEnd",{H2:b.Lc.prototype.H2});b.Lc.prototype.P2=
function(){return this.uE};b.b.g("CollectionHeaderSet.prototype.getHeaders",{P2:b.Lc.prototype.P2});b.Lc.prototype.Cy=function(){return this.Bg};b.b.g("CollectionHeaderSet.prototype.getRowHeader",{Cy:b.Lc.prototype.Cy});b.Gd=function(f,a,d,c,e){b.l.ly(e);this.Li=f;this.or=a;this.$k=d;this.nr=c;this.Rd=e};o_("CollectionCellSet",b.Gd,b);b.Gd.prototype.c5=function(f){b.l.KD(f);null!=f&&f.length===this.R("row")&&(this.rr=f)};b.Gd.prototype.getData=function(b){var a;a=this.Ob(b);return null==a?null:a.get(this.Rd[b.column])};
b.b.g("CollectionCellSet.prototype.getData",{getData:b.Gd.prototype.getData});b.Gd.prototype.getMetadata=function(f){var a;a=this.Ob(f);return null==a?null:{keys:{row:b.ip.jt(a),column:this.Rd[f.column]}}};b.b.g("CollectionCellSet.prototype.getMetadata",{getMetadata:b.Gd.prototype.getMetadata});b.Gd.prototype.Ob=function(f){var a;if(null==this.rr)return null;b.l.Ff(f);a=f.row;f=f.column;b.l.assert(a>=this.Li&&a<=this.or&&f>=this.$k&&f<=this.nr);return this.rr[a-this.Li]};b.Gd.prototype.R=function(b){return"row"===
b?Math.max(0,this.or-this.Li):"column"===b?Math.max(0,this.nr-this.$k):0};b.b.g("CollectionCellSet.prototype.getCount",{R:b.Gd.prototype.R});b.Gd.prototype.getStartRow=function(){return this.Li};b.b.g("CollectionCellSet.prototype.getStartRow",{getStartRow:b.Gd.prototype.getStartRow});b.Gd.prototype.J2=function(){return this.or};b.b.g("CollectionCellSet.prototype.getEndRow",{J2:b.Gd.prototype.J2});b.Gd.prototype.getStartColumn=function(){return this.$k};b.b.g("CollectionCellSet.prototype.getStartColumn",
{getStartColumn:b.Gd.prototype.getStartColumn});b.Gd.prototype.I2=function(){return this.nr};b.b.g("CollectionCellSet.prototype.getEndColumn",{I2:b.Gd.prototype.I2});b.Gd.prototype.Ho=function(){return this.Rd};b.b.g("CollectionCellSet.prototype.getColumns",{Ho:b.Gd.prototype.Ho});b.ip=function(){};b.ip.jt=function(b){var a;a=b.Zf();null==a&&(a=b.mp());return a};b.wa=function(f,a){this.Ba=f;null!=a&&(this.dz=a.rowHeader,this.columns=a.columns);this.f0();b.wa.q.constructor.call(this)};o_("CollectionDataGridDataSource",
b.wa,b);b.b.ga(b.wa,b.Rm,"oj.CollectionDataGridDataSource");b.wa.prototype.Init=function(){b.wa.q.Init.call(this);this.Dm={};this.kL()};b.b.g("CollectionDataGridDataSource.prototype.Init",{Init:b.wa.prototype.Init});b.wa.prototype.kL=function(){this.Ba.on("add",this.vfa.bind(this));this.Ba.on("remove",this.xfa.bind(this));this.Ba.on("change",this.wfa.bind(this));this.Ba.on("refresh",this.Oea.bind(this));this.Ba.on("reset",this.Pea.bind(this))};b.wa.prototype.Pga=function(){return null!=this.data};
b.wa.prototype.R=function(b){var a;void 0==this.precision&&(this.precision={});if("row"==b){a=this.je();if(-1===a||0===a&&(!this.Pga()||0<this.oo()))return this.precision[b]="estimate",-1;this.precision[b]="exact";return this.oo()}if("column"==b){if(null!=this.columns)return this.precision[b]="exact",this.columns.length;this.precision[b]="estimate";return-1}return 0};b.b.g("CollectionDataGridDataSource.prototype.getCount",{R:b.wa.prototype.R});b.wa.prototype.ug=function(b){null!=this.precision&&null!=
this.precision[b]||this.R(b);return this.precision[b]};b.b.g("CollectionDataGridDataSource.prototype.getCountPrecision",{ug:b.wa.prototype.ug});b.wa.prototype.If=function(b,a,d){var c,e;null!=a&&(c=b.axis,e={},e.y3=b,e.callbacks=a,e.ny=d,this.Dm[c]=e)};b.b.g("CollectionDataGridDataSource.prototype.fetchHeaders",{If:b.wa.prototype.If});b.wa.prototype.jfa=function(f,a,d,c){var e,g,h,k;e=f.axis;g=f.start;h=f.count;if("column"===e)null!=this.columns?(c=Math.min(this.columns.length,g+h),k=new b.Lc(g,c,
this.columns,void 0,this.Ci)):k=new b.Fd(g,g,e,null);else if("row"===e){if(null!=this.dz){null!=c&&(h=c.count);c=Math.min(this.oo(),g+h);k=new b.Lc(g,c,this.columns,this.dz);this.w_(g,c,k,f,a,d);return}k=new b.Fd(g,g,e,null)}null!=a&&a.success&&a.success.call(d.success,k,f)};b.wa.prototype.yW=function(b){var a,d,c,e,g,h;for(a=0;a<b.length;a+=1)d=b[a],"row"===d.axis?(c=d.start,e=d.count):"column"===d.axis&&(g=d.start,h=d.count);return{rowStart:c,rowCount:e,colStart:g,colCount:h}};b.wa.prototype.Gea=
function(f,a,d,c){var e,g,h;e=this.yW(f);g=e.rowStart;c=null!=c?Math.min(this.oo(),g+c.count):Math.min(this.oo(),g+e.rowCount);h=e.colStart;e=Math.min(null==this.columns?0:this.columns.length,h+e.colCount);e=new b.Gd(g,c,h,e,this.columns);this.w_(g,c,e,f,a,d)};b.wa.prototype.w_=function(b,a,d,c,e,g){var h;for(h=[];b<a;b++)h.push(this.Ba.at(b,{deferred:!0}));Promise.all(h).then(function(a){d.c5(a);e.success.call(g.success,d,c)})};b.wa.prototype.tg=function(b,a,d){null!=a&&(this.Dg={},this.Dg.H1=b,
this.Dg.callbacks=a,this.Dg.ny=d);this.xca(b)};b.b.g("CollectionDataGridDataSource.prototype.fetchCells",{tg:b.wa.prototype.tg});b.wa.prototype.wZ=function(b){var a,d,c,e,g;a=this.Dm[b];null!=a&&(d=a.y3,c=a.callbacks,e=a.ny,"row"===b&&(g=a.NM),this.jfa(d,c,e,g),this.Dm[b]=null)};b.wa.prototype.Mia=function(){this.Gea(this.Dg.H1,this.Dg.callbacks,this.Dg.ny,this.Dg.NM)};b.wa.prototype.xca=function(b){var a;b=this.yW(b);a=b.rowStart;this.Ba.ez(a,b.rowCount).then(function(b){this.data=!0;this.qka(b.start,
b.count);void 0===this.columns?this.Ba.at(a,{deferred:!0}).then(function(a){null!=a&&this.QL(a);this.lV()}.bind(this)):this.lV()}.bind(this),function(a){this.yca(a)}.bind(this))};b.wa.prototype.yca=function(f){b.r.error(f);null!=this.Dm&&(this.xZ("column",f),this.xZ("row",f));null!=this.Dg&&this.Nia(f)};b.wa.prototype.xZ=function(b,a){var d,c,e;d=this.Dm[b];null!=d&&(c=d.callbacks,e=d.ny,d=d.y3,c.error&&c.error.call(e.error,a,d),this.Dm[b]=null)};b.wa.prototype.Nia=function(b){var a,d,c;a=this.Dg.callbacks;
d=this.Dg.ny;c=this.Dg.H1;a.error&&a.error.call(d.error,b,c);this.Dg=null};b.wa.prototype.lV=function(){null!=this.Dm&&(this.wZ("column"),this.wZ("row"));null!=this.Dg&&this.Mia()};b.wa.prototype.qka=function(b,a){var d={start:b,count:a};null!=this.Dm.row&&(this.Dm.row.NM=d);null!=this.Dg&&(this.Dg.NM=d)};b.wa.prototype.QL=function(b){this.columns=b.keys();-1!=this.columns.indexOf(this.dz)&&this.columns.splice(this.columns.indexOf(this.dz),1)};b.wa.prototype.keys=function(f){var a,d,c,e,g;a=f.row;
d=f.column;g=this;return new Promise(function(f){g.Ba.at(a,{deferred:!0}).then(function(a){null==a?f({row:null,column:null}):(c=b.ip.jt(a),null==g.columns&&g.QL(a),e=g.columns[d],f({row:c,column:e}))}.bind(g))})};b.b.g("CollectionDataGridDataSource.prototype.keys",{keys:b.wa.prototype.keys});b.wa.prototype.yg=function(b){var a,d,c,e;a=b.row;d=b.column;e=this;return new Promise(function(b){e.Ba.indexOf(a,{deferred:!0}).then(function(a){-1===a?b({row:-1,column:-1}):null==e.columns?e.Ba.at(a,{deferred:!0}).then(function(f){e.QL(f);
c=e.columns.indexOf(d);-1===c&&(a=-1);b({row:a,column:c})}.bind(e)):(c=e.columns.indexOf(d),-1===c&&(a=-1),b({row:a,column:c}))}.bind(e))})};b.b.g("CollectionDataGridDataSource.prototype.indexes",{yg:b.wa.prototype.yg});b.wa.prototype.getCapability=function(b){return"sort"===b?"column":"move"===b?"row":null};b.b.g("CollectionDataGridDataSource.prototype.getCapability",{getCapability:b.wa.prototype.getCapability});b.wa.prototype.sort=function(b,a,d){var c,e,g;null==d&&(d={});null==b?this.yL(a,d):(e=
b.direction,g=b.key,b=b.axis,"column"===b?(this.Ba.Wa()?(this.Ba.comparator=g,this.Ba.sortDirection="ascending"===e?1:-1):("ascending"===e&&(c=function(a,b){var c,d;a=a.get(g);b=b.get(g);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString(),c=!0);b instanceof Date&&(b=b.toISOString(),d=!0);return c&&d?a<b?-1:a===b?0:1:c?1:d?-1:a-b}),"descending"===e&&(c=function(a,b){var c,d;a=a.get(g);b=b.get(g);c=isNaN(a);d=isNaN(b);a instanceof Date&&(a=a.toISOString());b instanceof Date&&(b=b.toISOString());
return c&&d?a>b?-1:a===b?0:1:c?-1:d?1:b-a}),this.Ba.comparator=c),this.Ba.sort(),this.f0(g),null!=a&&null!=a.success&&a.success.call(d.success)):null!=a&&null!=a.error&&a.error.call(d.error,"Axis value not supported"))};b.b.g("CollectionDataGridDataSource.prototype.sort",{sort:b.wa.prototype.sort});b.wa.prototype.yL=function(b,a){this.Ba.comparator=null;this.Ba.reset();null!=b&&null!=b.success&&b.success.call(a.success)};b.wa.prototype.f0=function(b){var a,d;a=this.Ba.comparator;d=-1===this.Ba.sortDirection?
"descending":"ascending";null==b&&"function"===typeof a?this.Ci={}:(this.Ci={},this.Ci.axis="column",this.Ci.direction=d,this.Ci.key=null==b?a:null)};b.wa.prototype.move=function(b,a,d,c,e){var g;this.Ba.get(b,{deferred:!0}).then(function(d){null==a?(this.Ba.remove(d),this.Ba.add(d),null!=c&&null!=c.success&&c.success.call(e.success)):(b===a?(g=this.Ba.indexOf(a,{deferred:!0}),this.Ba.remove(d)):(this.Ba.remove(d),g=this.Ba.indexOf(a,{deferred:!0})),g.then(function(a){this.Ba.add(d,{at:a,Pra:!0});
null!=c&&null!=c.success&&c.success.call(e.success)}.bind(this)))}.bind(this))};b.b.g("CollectionDataGridDataSource.prototype.move",{move:b.wa.prototype.move});b.wa.prototype.od=function(){return"valid"};b.b.g("CollectionDataGridDataSource.prototype.moveOK",{od:b.wa.prototype.od});b.wa.prototype.qk=function(b,a,d,c,e){var g={source:this};g.operation=b;g.keys={row:a,column:d};g.indexes={row:c,column:e};return g};b.wa.prototype.vfa=function(f){var a,d;this.Ba.indexOf(f,{deferred:!0}).then(function(c){d=
b.ip.jt(f);a=this.qk("insert",d,null,c,-1);this.handleEvent("change",a)}.bind(this))};b.wa.prototype.xfa=function(f,a,d){this.handleEvent("change",this.qk("delete",b.ip.jt(f),null,d.index,-1))};b.wa.prototype.wfa=function(f){var a,d;this.Ba.indexOf(f,{deferred:!0}).then(function(c){d=b.ip.jt(f);a=this.qk("update",d,null,c,-1);this.handleEvent("change",a)}.bind(this))};b.wa.prototype.Oea=function(){this.data=null;this.handleEvent("change",this.qk("refresh",null,null))};b.wa.prototype.Pea=function(){this.data=
null;this.handleEvent("change",this.qk("reset",null,null))};b.wa.prototype.oo=function(){return this.Ba.size()};b.wa.prototype.je=function(){return void 0===this.Ba.totalResults?-1:this.Ba.totalResults};b.wa.prototype.C2=function(){return this.Ba};b.b.g("CollectionDataGridDataSource.prototype.getCollection",{C2:b.wa.prototype.C2});b.wa.prototype.Ho=function(){return this.columns};b.b.g("CollectionDataGridDataSource.prototype.getColumns",{Ho:b.wa.prototype.Ho});b.wa.prototype.Cy=function(){return this.dz};
b.b.g("CollectionDataGridDataSource.prototype.getRowHeader",{Cy:b.wa.prototype.Cy});b.wa.prototype.getData=function(){return this.data};b.b.g("CollectionDataGridDataSource.prototype.getData",{getData:b.wa.prototype.getData})});