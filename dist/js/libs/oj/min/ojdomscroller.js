/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery"],function(b,f){b.Yf=function(a,b,c){c=c||{};this.i=b;this.eB=a;this.$s=c.fetchSize;this.$s=0<this.$s?this.$s:25;this.Kt=c.maxCount;this.Kt=0<this.Kt?this.Kt:500;this.TC=0;this.H0=c.success;this.pca=c.error;this.Iq();f(this.eB).on("scroll.domscroller",function(a){var b=f(a.target).scrollTop();a=f(a.target)[0].scrollHeight-f(a.target)[0].clientHeight;0<a&&this.VJ(b,a)}.bind(this))};b.Yf.prototype.destroy=function(){this.Gk();f(this.eB).off("scroll.domscroller")};b.b.g("DomScroller.prototype.destroy",
{destroy:b.Yf.prototype.destroy});b.Yf.prototype.checkViewport=function(){return 0<this.eB[0].clientHeight&&!this.haa()?this.oV():Promise.resolve(null)};b.b.g("DomScroller.prototype.checkViewport",{checkViewport:b.Yf.prototype.checkViewport});b.Yf.prototype.VJ=function(a,b){if(1>=b-a){var c=this;this.oV().then(function(a){null!=c.H0&&c.H0(a)},this.pca)}};b.Yf.prototype.haa=function(){var a=this.eB;return a[0].scrollHeight>a[0].clientHeight+1?!0:!1};b.Yf.prototype.oV=function(){if(this.hB)return this.hB;
var a=this.Kt-this.TC;if(0<a){var b=this.$s,c=this;a<this.$s&&(b=a);var e=this.zca({pageSize:b});return this.hB=new Promise(function(b){e.then(function(d){c.hB=null;null!=d&&(c.TC=d.data.length+d.startIndex,a<c.$s&&(d.maxCount=c.Kt,d.maxCountLimit=!0));b(d)})})}return Promise.resolve({maxCount:this.Kt,maxCountLimit:!0})};b.Yf.prototype.zca=function(a){a=a||{};var b=a.pageSize;this.Fh=this.Fh?this.Fh+b:b;if(-1==this.i.totalSize()||this.i.totalSize()>this.Fh){var c=this;return new Promise(function(a,
f){c.i.fetch({startIndex:c.Fh,pageSize:b}).then(function(b){a(b)},function(){f(null)})})}return Promise.resolve()};b.Yf.prototype.Rn=function(){this.Fh=null;this.TC=0};b.Yf.prototype.Uea=function(a){this.Fh=a.startIndex;this.TC=a.data.length+this.Fh};b.Yf.prototype.Iq=function(){var a=this.i;if(null!=a){this.Gk();this.Ua=[];this.Ua.push({eventType:b.T.D.SORT,eventHandler:this.Rn.bind(this)});this.Ua.push({eventType:b.T.D.REFRESH,eventHandler:this.Rn.bind(this)});this.Ua.push({eventType:b.T.D.RESET,
eventHandler:this.Rn.bind(this)});this.Ua.push({eventType:b.T.D.SYNC,eventHandler:this.Uea.bind(this)});var d,c;for(d=0;d<this.Ua.length;d++)(c=a.on(this.Ua[d].eventType,this.Ua[d].eventHandler))&&(this.Ua[d].eventHandler=c)}};b.Yf.prototype.Gk=function(){var a=this.i;if(null!=this.Ua&&null!=a){var b;for(b=0;b<this.Ua.length;b++)a.off(this.Ua[b].eventType,this.Ua[b].eventHandler)}}});